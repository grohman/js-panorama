/*
$.panorama version 1.0
by danyagrohman@gmail.com
*/
(function(c){function q(e,j){this.defaults={debug:!1,clickedWrapperClass:"ui-panorama-click-wrapper",clickedWrapperZindex:2,clickedElementClass:"ui-panorama-clicked",animationDuration:500,animationEasing:"easeOutExpo",titleSelector:"h1",itemsContainerSelector:".ui-panorama-items",itemSelector:".ui-panorama-item",backgroundAnimationStep:0,titleAnimationStep:15,itemsGapPercentage:10,waitXpercentage:5,waitYpercentage:5,backPointPercentage:10,itemsLeftMarginPercent:0,totalNumberOfItems:0,controlInitializedEventName:"controlInitialized",
selectedItemChangedEventName:"selectedItemChanged"};if(!c(e).data("panorama")){c(e).css({"-ms-content-zooming":"none","-ms-touch-action":"none"});this.opts=c.extend({},this.defaults,j);this.opts=c.extend(this.opts,{currentIndex:0,busy:!1,_item_width:0,eventsSettings:{useSetReleaseCapture:!1,lastXYById:{},moved:0,yDirection:null},debug:!0==this.opts.debug&&c("<div>").css({position:"fixed",bottom:"0px",right:"0px",background:"white",border:"1px solid red",overflow:"hidden",width:"200px",height:"20%",
zIndex:"9999",color:"black"}).appendTo("body")});var g=c(window).width()/100;this.opts.waitXpercentage=Math.round(g*this.opts.waitXpercentage);this.opts.waitYpercentage=Math.round(g*this.opts.waitYpercentage);this.opts.backPointPercentage=Math.round(g*this.opts.backPointPercentage);0==parseInt(this.opts.totalNumberOfItems)&&(this.opts.totalNumberOfItems=c(e).children(this.opts.itemsContainerSelector).children(this.opts.itemSelector).length);0==parseInt(this.opts.backgroundAnimationStep)&&(this.opts.backgroundAnimationStep=
Math.round(100/this.opts.totalNumberOfItems));this.$el=c(e);c("<div>").addClass(this.opts.clickedWrapperClass).css({zIndex:this.opts.clickedWrapperZindex,opacity:"0",width:c(window).width(),height:c(window).height(),position:"fixed",left:"0px",top:"0px",background:"black",overflow:"scroll"}).prependTo(this.$el);this.opts.debug&&(g=c("<div>").css({position:"fixed",bottom:"0px",left:"0px",background:"white",border:"1px solid red",color:"black"}).appendTo("body"),c("<h2>").html('<a href="#" onclick="$(\'.'+
this.$el.attr("class")+"').data('obj').goToNext();\">swipe left</a>").appendTo(g),c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goToPrevious();\">swipe right</a>").appendTo(g),c("<h2>").html('<a href="#" onclick="$(\'.'+this.$el.attr("class")+"').data('obj').goTo(3);\">go to screen 3</a>").appendTo(g),c("<h2>").html('<a href="#" onclick="alert($(\'.'+this.$el.attr("class")+"').data('obj').opts.currentIndex);\">get current idx</a>").appendTo(g));this.getItemsContainer=
function(){return this.$el.children(this.opts.itemsContainerSelector)};this.getItems=function(){return this.getItemsContainer().children(this.opts.itemSelector)};this.getItem=function(b){return this.getItemsContainer().children(this.opts.itemSelector+":eq("+b+")")};this.getLastItem=function(){return this.getItem(this.opts.totalNumberOfItems-1)};this.getTitle=function(){return this.$el.children(this.opts.titleSelector)};this.fixIndex=function(b){0>b?b+=this.opts.totalNumberOfItems:b>=this.opts.totalNumberOfItems&&
(b-=this.opts.totalNumberOfItems);return b};this.getCurrentItem=function(){return this.getItems().eq(this.opts.currentIndex)};this.goTo=function(b){var c=this,d=setInterval(function(){c.opts.currentIndex==b?clearInterval(d):c.opts.currentIndex<b?c.goToNext():c.goToPrevious()},c.opts.animationDuration)};this.goToNext=function(){this.changeItem(!0)};this.goToPrevious=function(){this.changeItem(!1)};this.setEvents=function(b){function e(a){if(Object.keys)return Object.keys(a).length;var b=0,c;for(c in a)++b;
return b}function d(h){if(!("mousemove"==h.type&&0==e(a.opts.eventsSettings.lastXYById))){h.preventDefault&&h.preventDefault();h.preventManipulation&&h.preventManipulation();h.preventMouseEvent&&h.preventMouseEvent();for(var q=h.changedTouches?h.changedTouches:[h],t=0;t<q.length;++t){var m=q[t],p="undefined"!=typeof m.identifier?m.identifier:"undefined"!=typeof m.pointerId?m.pointerId:1,f=m;if("undefined"==typeof f.pageX)if(f.pageX=f.offsetX+documentToTargetDelta.x,f.pageY=f.offsetY+documentToTargetDelta.y,
f.srcElement.offsetParent==b&&document.documentMode&&8==document.documentMode&&"mousedown"==f.type)f.pageX+=f.srcElement.offsetLeft,f.pageY+=f.srcElement.offsetTop;else if(f.srcElement!=b&&!document.documentMode||8>document.documentMode){for(var r=-2,s=-2,l=f.srcElement;null!=l;l=l.parentNode)r+=l.scrollLeft?l.scrollLeft:0,s+=l.scrollTop?l.scrollTop:0;f.pageX=f.clientX+r;f.pageY=f.clientY+s}f=m.pageX;m=m.pageY;if(h.type.match(/(start|down)$/i)){s=r=a.opts.eventsSettings.moved=0;for(l=b;null!=l;l=
l.offsetParent){if(!navigator.userAgent.match(/\bMSIE\b/)||document.documentMode&&!(8>document.documentMode)||!("relative"==l.currentStyle.position&&l.offsetParent&&"relative"==l.offsetParent.currentStyle.position&&l.offsetLeft==l.offsetParent.offsetLeft))r+=l.offsetLeft;s+=l.offsetTop}documentToTargetDelta={x:r,y:s};if(a.opts.eventsSettings.lastXYById[p]){delete a.opts.eventsSettings.lastXYById[p];a.opts.debug&&c("<div>").html("force end").prependTo(a.opts.debug);a.getItemsContainer().css({left:"0px"});
break}a.opts.debug&&c("<div>").html("start at "+f+"px").prependTo(a.opts.debug);a.opts.eventsSettings.lastXYById[p]={x:f,y:m};j=f;g=m;b.msSetPointerCapture?b.msSetPointerCapture(p):"mousedown"==h.type&&1==e(a.opts.eventsSettings.lastXYById)&&(a.opts.eventsSettings.useSetReleaseCapture?b.setCapture(!0):(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",d,!1)));c("."+a.opts.clickedWrapperClass).hide();c(document.elementFromPoint(f,m)).addClass(a.opts.clickedElementClass);
c("."+a.opts.clickedWrapperClass).show()}else if(h.type.match(/move$/i))void 0!==a.opts.eventsSettings.lastXYById[p]&&(a.opts.eventsSettings.lastXYById[p].x=f,a.opts.eventsSettings.lastXYById[p].y=m,k=f-j,n=g-m,mNewX=Math.abs(k),mNewY=Math.abs(n),p=a.opts.waitXpercentage,m=a.opts.waitYpercentage,mNewY>m&&mNewX<p?(0<n&&"up"!=a.opts.eventsSettings.yDirection?(n-=m,a.opts.eventsSettings.yDirection="down"):(n+=m,a.opts.eventsSettings.yDirection="up"),!1==a.opts.busy&&(n+=a.getItem(a.opts.currentIndex).scrollTop(),
g+=a.getItem(a.opts.currentIndex).scrollTop()),a.opts.busy=!0,a.getItem(a.opts.currentIndex).scrollTop(n),a.opts.eventsSettings.moved=n,a.opts.debug&&c("<div>").html("going "+a.opts.eventsSettings.yDirection+": "+n).prependTo(a.opts.debug),k=0):mNewX>p?(0>k&&(p=-p),a.opts.eventsSettings.moved=k-p,a.opts.debug&&c("<div>").html("move: "+a.opts.eventsSettings.moved+"px").prependTo(a.opts.debug),!1==a.opts.busy&&a.getItemsContainer().css({left:a.opts.eventsSettings.moved+"px"})):(n=k=0,a.opts.eventsSettings.moved=
0));else if(a.opts.eventsSettings.lastXYById[p]&&h.type.match(/(up|end|cancel)$/i)){delete a.opts.eventsSettings.lastXYById[p];b.msReleasePointerCapture?b.msReleasePointerCapture(p):"mouseup"==h.type&&0==e(a.opts.eventsSettings.lastXYById)&&(a.opts.eventsSettings.useSetReleaseCapture?b.releaseCapture():(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",d,!1)));a.opts.debug&&c("<div>").html("end").prependTo(a.opts.debug);null!=a.opts.eventsSettings.yDirection&&(a.opts.eventsSettings.yDirection=
null,a.opts.busy=!1);var u=setInterval(function(){!1==a.opts.busy&&(clearInterval(u),0<k?(k<a.opts.backPointPercentage?a.getItemsContainer().animate({left:"0px"},a.opts.animationDuration,a.opts.animationEasing):a.goToPrevious(),k=0):0>k&&(k>-a.opts.backPointPercentage?a.getItemsContainer().animate({left:"0px"},a.opts.animationDuration,a.opts.animationEasing):a.goToNext(),k=0))},10);setTimeout(function(){c("."+a.opts.clickedElementClass).each(function(){c(this).removeClass(a.opts.clickedElementClass);
(0==a.opts.eventsSettings.moved||void 0===a.opts.eventsSettings.moved)&&c(this).click()});null==a.opts.eventsSettings.yDirection&&(a.opts.eventsSettings.moved=0)},100)}}}}var a=this;if(window.navigator.msPointerEnabled)b.addEventListener("MSPointerDown",d,!1),b.addEventListener("MSPointerMove",d,!1),b.addEventListener("MSPointerUp",d,!1),b.addEventListener("MSPointerCancel",d,!1),"undefined"!=typeof b.style.msContentZooming&&(b.style.msContentZooming="none"),"undefined"!=typeof b.style.msTouchAction&&
(b.style.msTouchAction="none"),a.opts.debug&&c("<div>").html("Using Microsoft pointer model").prependTo(a.opts.debug);else if(b.addEventListener)b.addEventListener("touchstart",d,!1),b.addEventListener("touchmove",d,!1),b.addEventListener("touchend",d,!1),b.addEventListener("touchcancel",d,!1),b.addEventListener("mousedown",d,!1),b.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(this.opts.eventsSettings.useSetReleaseCapture=!0,b.addEventListener("mousemove",d,!1),b.addEventListener("mouseup",
d,!1)),a.opts.debug&&c("<div>").html("Using mouse model with capture").prependTo(a.opts.debug);else if(b.attachEvent&&b.setCapture)a.opts.eventsSettings.useSetReleaseCapture=!0,b.attachEvent("onmousedown",function(){d(window.event);return window.event.returnValue=!1}),b.attachEvent("onmousemove",function(){d(window.event);return window.event.returnValue=!1}),b.attachEvent("onmouseup",function(){d(window.event);return window.event.returnValue=!1}),a.opts.debug&&c("<div>").html("Using legacy IE mode - mouse model with capture").prependTo(a.opts.debug);
else return a.opts.debug&&c("<div>").html("Unexpected combination of supported features").prependTo(a.opts.debug),!1;var j,k,g,n;this.$el.data("obj",a);this.$el.trigger(a.opts.controlInitializedEventName);return!0};this.changeItem=function(b){if(this.opts.busy)return!1;this.opts.busy=!0;this.opts.debug&&(b?c("<div>").html("swipe left").prependTo(this.opts.debug):c("<div>").html("swipe right").prependTo(this.opts.debug));var e,d,a=this.getItem(this.opts.currentIndex);d=this.fixIndex(b?this.opts.currentIndex+
1:this.opts.currentIndex-1);e=this.fixIndex(b?this.opts.currentIndex+2:this.opts.currentIndex+1);var g=this.getItem(d),k=2<this.totalNumberOfItems?this.getItem(e):void 0,j,n;!b&&g&&(g.css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent}),3<this.totalNumberOfItems&&(j=this.fixIndex(d-1),n=this.getItem(j),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+d+")").not(":eq("+j+")").hide(),this.getItem(this.fixIndex(d-1)).css({left:-this.opts._item_width+this.opts.itemsLeftMarginPercent})));
b&&k&&(k.css({left:2*this.opts._item_width+this.opts.itemsLeftMarginPercent}),this.getItems().not(":eq("+this.opts.currentIndex+")").not(":eq("+e+")").hide());b={left:(b?"-=":"+=")+this.opts._item_width};var h=this;e=function(){h.opts.currentIndex=d;n&&n.show();h.opts.busy=!1;h.opts.eventsSettings.lastXYById={};h.$el.trigger(h.opts.selectedItemChangedEventName)};g&&g.show();k&&k.show();g&&g.animate(b,this.opts.animationDuration,this.opts.animationEasing,e);k&&k.animate(b,this.opts.animationDuration,
this.opts.animationEasing);a.animate(b,this.opts.animationDuration,this.opts.animationEasing);this.getItemsContainer().animate({left:"0px"},this.opts.anumationDuration,this.opts.animationEasing);this.opts.titleSelector&&this.getTitle().animate({marginLeft:-d*this.opts.titleAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);this.$el.animate({backgroundPositionX:d*this.opts.backgroundAnimationStep+"%"},this.opts.animationDuration,this.opts.animationEasing);return!0}}}q.prototype=
{init:function(){return this.$el?(this.$el.attr("data-panorama",!0),this.prepare(this.$el),!0):!1},prepare:function(e){var j=e.parent().height()+1,g=this.getItemsContainer().position().top,b=j-g;e.height(b);this.getItemsContainer().height(b);this.totalNumberOfItems=this.getItems().length;var q=e.outerWidth()*(100-this.opts.itemsGapPercentage)/100;this.opts._item_width=q;e=Math.round(c(window).width()/100*this.opts.itemsLeftMarginPercent);this.opts.itemsLeftMarginPercent=e;this.getItems().each(function(d,
a){c(a).height(b-(c(a).outerHeight()-c(a).height()));c(a).width(q-(c(a).outerWidth()-c(a).width()));1==d&&c(a).css({left:q});1<d&&c(a).hide()});2<this.opts.totalNumberOfItems&&(this.getLastItem().css({left:"-"+q+"px"}).show(),this.getItems().css("left","+="+e+"px"))},show:function(){var e=this;this.getItemsContainer().fadeIn(function(){var j=e.getItemsContainer().position().top;e.getItems().each(function(){c(this).css("height","-="+j+"px")})})}};c.fn.panorama=function(e){this.length&&this.each(function(){var j=
new q(this,e);j.init()&&(j.setEvents(this),j.show(),c(this).data("panorama",j))})}})(jQuery);$.easing.easeOutExpo=function(c,q,e,j,g){return q==g?e+j:j*(-Math.pow(2,-10*q/g)+1)+e};